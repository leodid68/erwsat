# ERWSat - Plan de Développement v2

## Résumé Exécutif

Application de quiz SAT avec génération de questions IA. Bonne base mais nécessite:
- Corrections critiques (bugs, erreurs silencieuses)
- Refactoring architecture (stores, composants)
- Améliorations UX majeures
- Nouvelles fonctionnalités (bibliothèque de textes, types variés)

---

## PHASE 1: Corrections Critiques (Priorité Haute)

### 1.1 Bugs & Erreurs Silencieuses
- [ ] **Fix default answer bug** - `quiz-store.ts:138` utilise 'A' par défaut au lieu de null
- [ ] **Fix partial generation** - Si 1 question échoue, tout échoue silencieusement
- [ ] **Add timeout handling** - Ollama/Sonnet peuvent timeout sans feedback
- [ ] **Fix session persistence** - Reload page = perte progression quiz

### 1.2 Validation & Sécurité
- [ ] **Validation API boundaries** - Ajouter Zod schemas sur toutes les routes
- [ ] **Sanitize external content** - Guardian/Wikipedia peuvent contenir HTML
- [ ] **Rate limiting** - Éviter spam API Sonnet
- [ ] **Max file size feedback** - Afficher limite avant upload, pas après erreur

### 1.3 Error Handling
- [ ] **Retry logic** - 3 retries avec backoff pour APIs externes
- [ ] **User-friendly errors** - Codes d'erreur + messages FR
- [ ] **Toast notifications** - Feedback visuel pour succès/erreurs

---

## PHASE 2: Refactoring Architecture

### 2.1 Store Separation (quiz-store.ts = 252 lignes, trop)
```
quiz-store.ts →
  ├── document-store.ts (documents, passages)
  ├── quiz-store.ts (quizzes, questions)
  ├── session-store.ts (current quiz session, answers)
  └── progress-store.ts (history, streaks, stats)
```

### 2.2 Component Extraction (upload/page.tsx = 546 lignes)
```
upload/page.tsx →
  ├── FileUploadTab.tsx
  ├── GutenbergTab.tsx
  ├── WikipediaTab.tsx
  └── GuardianTab.tsx
```

### 2.3 Consolidation Text Processing
- [ ] Fusionner `text-processor.ts` et `text-sources.ts`
- [ ] Créer `chunking-service.ts` unifié
- [ ] Constantes partagées pour SAT lengths

### 2.4 API Route Organization
```
/api/
  ├── sources/
  │   ├── gutenberg/
  │   ├── wikipedia/
  │   └── guardian/
  ├── generation/
  │   ├── questions/
  │   └── passages/
  └── quiz/
      ├── create/
      └── submit/
```

---

## PHASE 3: UX & Ergonomie

### 3.1 Upload Experience
- [ ] **Multi-source selection** - Pouvoir ajouter plusieurs textes avant génération
- [ ] **Preview passages** - Voir les passages avant de valider
- [ ] **Quality indicators** - Montrer score qualité de chaque passage
- [ ] **Undo/redo** - Annuler sélection de passages

### 3.2 Generate Experience
- [ ] **Progress streaming** - Voir chaque question générée en temps réel
- [ ] **Preview mode** - Voir les questions avant de sauvegarder
- [ ] **Edit questions** - Modifier une question générée
- [ ] **Regenerate single** - Regénérer une seule question insatisfaisante

### 3.3 Quiz Taking
- [ ] **Timer display** - Temps par question et total
- [ ] **Review all** - Voir toutes réponses avant soumission
- [ ] **Bookmark** - Marquer questions pour révision (différent de flag)
- [ ] **Keyboard shortcuts** - A/B/C/D pour répondre, arrows pour naviguer

### 3.4 Results & Progress
- [ ] **Detailed analytics** - Temps par question, patterns d'erreurs
- [ ] **Weak point drilling** - Mode focus sur catégories faibles
- [ ] **Comparative stats** - Comparer avec moyenne SAT réelle

---

## PHASE 4: Nouvelles Fonctionnalités

### 4.1 Bibliothèque de Textes Aléatoires
```typescript
// Nouvelle feature: Random Text Library
interface TextLibrary {
  categories: {
    literature: ['gutenberg'],
    history: ['wikipedia'],
    science: ['wikipedia', 'guardian'],
    news: ['guardian'],
    poetry: ['gutenberg'], // Nouveau
    essays: ['wikipedia', 'guardian'],
  };
}

// API: GET /api/library/random?category=literature&count=3
```

**Fonctionnalités:**
- [ ] **Random par catégorie** - Choisir "Littérature" → 3 extraits aléatoires
- [ ] **Mix aléatoire** - Bouton "Surprise me" → mix de toutes catégories
- [ ] **Curated lists** - Listes pré-définies (ex: "Best of Shakespeare")
- [ ] **User favorites** - Sauvegarder textes préférés

### 4.2 Types de Textes Variés
- [ ] **Poetry mode** - Formatage spécial pour poèmes (line breaks)
- [ ] **Drama mode** - Formatage dialogues (déjà commencé)
- [ ] **Scientific mode** - Support figures/tables simplifiées
- [ ] **Opinion/Editorial** - Questions sur argumentation

### 4.3 Practice Modes
- [ ] **Quick Practice** - 5 questions random, 10 min
- [ ] **Full Test** - 52 questions, 65 min (SAT réel)
- [ ] **Category Focus** - Drill une catégorie spécifique
- [ ] **Review Mistakes** - Refaire questions ratées

### 4.4 Spaced Repetition
- [ ] **Wrong answer queue** - Questions ratées reviennent
- [ ] **Difficulty adjustment** - Plus d'erreurs = plus de révision
- [ ] **Daily review** - X questions/jour recommandées

### 4.5 Social & Export
- [ ] **Share quiz** - Lien partageable
- [ ] **PDF export** - Rapport de progression
- [ ] **Leaderboard local** - Comparer avec historique

---

## PHASE 5: Performance & Polish

### 5.1 Performance
- [ ] **Memoization** - useMemo sur calculs progress page
- [ ] **Lazy loading** - Charger composants quiz à la demande
- [ ] **Icon tree-shaking** - Import icons spécifiques seulement
- [ ] **API deduplication** - Éviter double-fetch

### 5.2 Accessibility
- [ ] **ARIA labels** - Tous les éléments interactifs
- [ ] **Keyboard nav** - Navigation complète clavier
- [ ] **Screen reader** - Annonces pour quiz flow
- [ ] **High contrast** - Mode haut contraste

### 5.3 Polish
- [ ] **Animations** - Transitions fluides entre questions
- [ ] **Sound effects** - Option sons correct/incorrect
- [ ] **Dark mode** - Thème sombre complet
- [ ] **Mobile responsive** - Optimiser pour mobile

---

## Priorités Suggérées

| Phase | Effort | Impact | Recommandation |
|-------|--------|--------|----------------|
| 1.1 Bugs critiques | 2h | Critique | **Faire maintenant** |
| 1.3 Error handling | 3h | Haut | **Faire maintenant** |
| 3.1 Multi-source | 4h | Haut | Semaine 1 |
| 4.1 Random library | 6h | Haut | Semaine 1-2 |
| 2.1 Store separation | 4h | Moyen | Semaine 2 |
| 3.2 Progress streaming | 3h | Moyen | Semaine 2 |
| 4.3 Practice modes | 8h | Haut | Semaine 3 |
| 5.1 Performance | 4h | Moyen | Semaine 4 |

---

## Questions pour Discussion

1. **Priorité features vs bugs?** - Corriger bugs d'abord ou ajouter features demandées?

2. **Random library scope?** - Combien de textes pré-chargés? Cache local?

3. **Poetry/Drama** - Faut-il des question types spécifiques pour poésie?

4. **Offline mode?** - Important d'avoir mode hors-ligne?

5. **Multi-langue?** - Garder FR ou ajouter EN?

6. **Cloud sync?** - Priorité pour sauvegarder dans le cloud?

---

## Fichiers Clés à Modifier

```
Priorité Critique:
├── src/stores/quiz-store.ts (split)
├── src/app/upload/page.tsx (split)
├── src/app/api/generate/route.ts (error handling)

Nouvelles Features:
├── src/app/api/library/ (nouveau)
├── src/components/library/ (nouveau)
├── src/lib/random-text-service.ts (nouveau)

UX Improvements:
├── src/components/quiz/QuestionCard.tsx
├── src/app/generate/page.tsx
└── src/components/ui/toast.tsx (nouveau)
```
